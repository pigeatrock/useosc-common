{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./index.js","webpack:///../src/graph.ts","webpack:///../src/library.ts","webpack:///../src/mutex.ts","webpack:///./node_modules/deepmerge/dist/cjs.js","webpack:///./node_modules/get-value/index.js","webpack:///./node_modules/has-value/index.js","webpack:///./node_modules/has-value/node_modules/isobject/index.js","webpack:///./node_modules/has-values/index.js","webpack:///./node_modules/is-plain-object/index.js","webpack:///./node_modules/isarray/index.js","webpack:///./node_modules/isobject/index.js","webpack:///./node_modules/omit-deep/index.js","webpack:///./node_modules/unset-value/index.js","webpack:///webpack://useoscEventEmitter/webpack/universalModuleDefinition","webpack:///webpack://useoscEventEmitter/webpack/bootstrap","webpack:///webpack://useoscEventEmitter/index.js","webpack:///./src/core.js","webpack:///./src/service-provider.js","webpack:///./src/utils.js","webpack:///external \"async_hooks\""],"names":["isMergeableObject","value","isNonNullObject","isSpecial","stringValue","Object","prototype","toString","call","isReactElement","canUseSymbol","Symbol","for","REACT_ELEMENT_TYPE","$$typeof","emptyTarget","val","Array","isArray","cloneUnlessOtherwiseSpecified","options","clone","deepmerge","defaultArrayMerge","target","source","concat","map","element","getMergeFunction","key","customMerge","getEnumerableOwnPropertySymbols","getOwnPropertySymbols","filter","symbol","propertyIsEnumerable","getKeys","keys","mergeObject","destination","forEach","arrayMerge","sourceIsArray","targetIsArray","sourceAndTargetTypesMatch","all","deepmergeAll","array","Error","reduce","prev","next","deepmerge_1","module","exports","obj","prop","a","b","c","isObject","segs","split","len","length","i","slice","join","require","hasValues","get","noZero","hasValue","o","undefined","hasOwnProperty","isObjectObject","isPlainObject","ctor","prot","constructor","arr","unset","omitDeep","j","has","TypeError","last","pop","shift","getEventNames","name","String","destroy","on","n","once","off","callback","force","ev","removable","emit","console","CoreBase","EventEmitter","defaultConfiguration","configuration","merger","merge","default","omitted","omit","logger","booted","started","destroyed","providers","providerHandler","boot","Promise","resolve","init","then","start","config","defaultValue","resolveTreeByKey","assign","register","ref","instance","bind","singleton","make","args","ServiceProvider","core","provides","depends","tree","result","e","each","list","method","p","provider","reject","catch","err","warn","instances","registry","createGraph","graph","Graph","dependsOnIndex","wants","findIndex","some","indexOf","addNode","Node","dependsOptions","dependsInstance","dindex","addDependency","traverse","handle","before","push","error","info","found","find"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export * from './src/core.js';\r\nexport * from './src/service-provider.js';","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar mutex_1 = require(\"./mutex\");\n/**\n * Base dependency graph class.\n */\nvar Graph = /** @class */ (function () {\n    function Graph() {\n        this.nodes = {};\n        this.outgoingEdges = {};\n        this.incomingEdges = {};\n    }\n    /**\n     * Add a node to the graph.\n     * @param node Node object.\n     */\n    Graph.prototype.addNode = function (node) {\n        if (this.hasNode(node.name))\n            throw new Error(\"A node with the name of \\\"\" + node.name + \"\\\" already exists in the graph!\");\n        this.nodes[node.name] = node;\n        this.outgoingEdges[node.name] = [];\n        this.incomingEdges[node.name] = [];\n    };\n    /**\n     * Remove a node by name from the graph.\n     * @param name Node name.\n     */\n    Graph.prototype.removeNode = function (name) {\n        if (!this.hasNode(name))\n            throw new Error(\"A node with the name of \\\"\" + name + \"\\\" does not exist in the graph!\");\n        delete this.nodes[name];\n        delete this.outgoingEdges[name];\n        delete this.incomingEdges[name];\n        for (var dependent in this.incomingEdges) {\n            if (this.incomingEdges[dependent].includes(name))\n                this.incomingEdges[dependent].splice(dependent.indexOf(name), 1);\n        }\n        for (var dependency in this.outgoingEdges) {\n            if (this.outgoingEdges[dependency].includes(name))\n                this.outgoingEdges[dependency].splice(dependency.indexOf(name), 1);\n        }\n    };\n    /**\n     * Checks to see if the graph contains a Node by name.\n     * @param name Node name.\n     */\n    Graph.prototype.hasNode = function (name) {\n        return this.nodes.hasOwnProperty(name);\n    };\n    Object.defineProperty(Graph.prototype, \"size\", {\n        /**\n         * Returns the number of nodes in a graph.\n         */\n        get: function () {\n            return Object.keys(this.nodes).length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Returns the Node instance given a node name.\n     * @param name Node name.\n     */\n    Graph.prototype.getNode = function (name) {\n        if (this.hasNode(name))\n            return this.nodes[name];\n        throw new Error(\"Node \\\"\" + name + \"\\\" not found!\");\n    };\n    /**\n     *  Adds a node dependence. \"from\" is dependent on \"to\"\n     *  @param from Node name.\n     *  @param to  Node name.\n     */\n    Graph.prototype.addDependency = function (from, to) {\n        if (!this.hasNode(from))\n            throw new Error(\"Node does not exist: \" + from);\n        if (!this.hasNode(to))\n            throw new Error(\"Node does not exist: \" + to);\n        if (from === to)\n            throw new Error(\"Cannot add self dependency: \" + to);\n        if (!this.outgoingEdges[from].includes(to)) {\n            this.outgoingEdges[from].push(to);\n        }\n        if (!this.incomingEdges[to].includes(from)) {\n            this.incomingEdges[to].push(from);\n        }\n    };\n    /**\n     * Removes a node dependence. \"from\" is no longer dependent on \"to\".\n     * @param from Node name.\n     * @param to  Node name.\n     * @todo Test this function.\n     */\n    Graph.prototype.removeDependency = function (from, to) {\n        console.warn('removeDependency() has not been tested.');\n        if (!this.hasNode(from))\n            throw new Error(\"Node does not exist: \" + from);\n        if (!this.hasNode(to))\n            throw new Error(\"Node does not exist: \" + to);\n        if (from === to)\n            throw new Error(\"Cannot remove self dependency: \" + to);\n        if (!this.outgoingEdges[from].includes(to)) {\n            this.outgoingEdges[from].splice(this.outgoingEdges[from].indexOf(to), 1);\n        }\n        if (!this.incomingEdges[to].includes(from)) {\n            this.incomingEdges[to].splice(this.incomingEdges[to].indexOf(to), 1);\n        }\n    };\n    /**\n     * Get dependency node names for a Node by name. (Required nodes for this node to execute).\n     * @param name Node name.\n     */\n    Graph.prototype.dependenciesOf = function (name) {\n        return this.outgoingEdges[name];\n    };\n    /**\n     * Get dependents node names for a Node by name. (Nodes that require this node to complete).\n     * @param name Node name.\n     */\n    Graph.prototype.dependentsOf = function (name) {\n        return this.incomingEdges[name];\n    };\n    /**\n     * Breadth first search.\n     */\n    Graph.prototype.traverse = function () {\n        var _this = this;\n        // Clear all complete node mutexes.\n        Object.keys(this.nodes).map(function (name) { return _this.getNode(name).clearMutex(); });\n        // Visiting a node recursively calls visit on each node's dependents.\n        var visit = function (node) {\n            // First await all dependencies\n            return Promise.all(_this.dependenciesOf(node.name).map(function (dependencyName) { return _this.nodes[dependencyName].awaitData(); }))\n                .then(function () {\n                node.signalDependenciesReady();\n                if (_this.dependentsOf(node.name).length > 0) {\n                    // Then recursively visit all dependents\n                    return Promise.all(_this.dependentsOf(node.name).map(function (dependentName) { return visit(_this.getNode(dependentName)); }));\n                }\n                else {\n                    // node has no dependents so await data\n                    return node.awaitData();\n                }\n            });\n        };\n        // Find nodes with no dependencies\n        var rootNodeNames = Object.keys(this.nodes).filter(function (name) { return _this.dependenciesOf(name).length === 0; });\n        if (rootNodeNames.length === 0 && Object.keys(this.nodes).length > 0)\n            return Promise.reject(new Error('The graph is circular. Cannot traverse graph due to no root node.'));\n        // Start recursive traversal from root nodes.\n        return Promise.all(rootNodeNames.map(function (name) { return visit(_this.nodes[name]); }));\n    };\n    /**\n     * Clears the value of a node and the values of dependent nodes\n     * @param name Node name.\n     */\n    Graph.prototype.clearNodeAndDependents = function (name) {\n        var _this = this;\n        var node = this.getNode(name);\n        var visitAndClear = function (node) {\n            if (node.hasData()) {\n                node.clearData();\n                return Promise.all(_this.dependentsOf(node.name).map(function (dependentName) { return visitAndClear(_this.getNode(dependentName)); }));\n            }\n            else {\n                return Promise.resolve();\n            }\n        };\n        return visitAndClear(node);\n    };\n    /**\n     * Resets the graph by resetting each node in the graph.\n     */\n    Graph.prototype.reset = function () {\n        for (var name in this.nodes) {\n            this.nodes[name].reset();\n        }\n    };\n    /**\n     * Prints graph nodes and node dependents.\n     */\n    Graph.prototype.ls = function () {\n        for (var name in this.nodes) {\n            console.log(name);\n            console.log(this.dependentsOf(name));\n        }\n    };\n    return Graph;\n}());\nexports.Graph = Graph;\nvar Node = /** @class */ (function () {\n    function Node(name, promise) {\n        this.locked = false;\n        this._name = name;\n        this._promise = promise;\n    }\n    Object.defineProperty(Node.prototype, \"name\", {\n        get: function () {\n            return this._name;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Await data.\n     * @returns A `Promise<T | null>` that resolves when the node's data is ready.\n     */\n    Node.prototype.awaitData = function () {\n        var _this = this;\n        if (!this.mutex) {\n            this.mutex = new mutex_1.Mutex(function () { return _this._data !== undefined; });\n        }\n        return new Promise(function (resolve, reject) {\n            _this.mutex.await(function (error) {\n                if (error)\n                    return reject(error);\n                resolve(_this._data);\n            });\n        });\n    };\n    Node.prototype.signalDependenciesReady = function () {\n        var _this = this;\n        if (!this.mutex) {\n            this.mutex = new mutex_1.Mutex(function () { return _this._data !== undefined; });\n        }\n        if (this._data === undefined) {\n            // Only allow to _promise once\n            if (this.locked === true)\n                return;\n            this.locked = true;\n            var promise = this._promise();\n            if (promise === undefined)\n                throw new Error(\"Node \\\"\" + this._name + \"\\\" has undefined promise.\");\n            promise.then(function (data) {\n                _this._data = data;\n                _this.locked = false;\n                _this.mutex.ready();\n            }).catch(function (error) {\n                _this._data = null;\n                _this.locked = false;\n                _this.mutex.ready(error);\n            });\n        }\n        else {\n            // Allow _data to be set externally from promise\n            this.mutex.ready();\n        }\n    };\n    Node.prototype.setData = function (data) {\n        this._data = data;\n        this.signalDependenciesReady();\n    };\n    /**\n     * Resets node. Clears all node data and resets its mutex.\n     */\n    Node.prototype.reset = function () {\n        this.clearData();\n        this.clearMutex();\n    };\n    Node.prototype.clearMutex = function () {\n        if (this.hasData())\n            this.mutex = undefined;\n    };\n    Node.prototype.hasData = function () {\n        return this._data !== undefined;\n    };\n    Node.prototype.clearData = function () {\n        this._data = undefined;\n    };\n    return Node;\n}());\nexports.Node = Node;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JhcGguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZ3JhcGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpQ0FBZ0M7QUFFaEM7O0dBRUc7QUFDSDtJQUFBO1FBQ1ksVUFBSyxHQUE2QixFQUFFLENBQUM7UUFDckMsa0JBQWEsR0FBaUMsRUFBRSxDQUFDO1FBQ2pELGtCQUFhLEdBQWlDLEVBQUUsQ0FBQztJQWlMN0QsQ0FBQztJQS9LRzs7O09BR0c7SUFDSSx1QkFBTyxHQUFkLFVBQWUsSUFBVTtRQUNyQixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztZQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsK0JBQTRCLElBQUksQ0FBQyxJQUFJLG9DQUFnQyxDQUFDLENBQUM7UUFDcEgsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDO1FBQzdCLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNuQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDdkMsQ0FBQztJQUVEOzs7T0FHRztJQUNJLDBCQUFVLEdBQWpCLFVBQWtCLElBQVk7UUFDMUIsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO1lBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQywrQkFBNEIsSUFBSSxvQ0FBZ0MsQ0FBQyxDQUFDO1FBQzNHLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4QixPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEMsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hDLEtBQUssSUFBTSxTQUFTLElBQUksSUFBSSxDQUFDLGFBQWEsRUFB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","\"use strict\";\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./graph\"));\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlicmFyeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9saWJyYXJ5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsNkJBQXdCIn0=","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Mutex = /** @class */ (function () {\n    function Mutex(readyTest) {\n        this.readyTest = readyTest;\n    }\n    Mutex.prototype.await = function (callback) {\n        if (this.readyTest() === true) {\n            callback();\n        }\n        else {\n            this.waiting = this.waiting || [];\n            this.waiting.push(callback);\n        }\n    };\n    // called when we know what we are waiting for is ready\n    Mutex.prototype.ready = function (error) {\n        if (this.waiting)\n            this.waiting.forEach(function (callback) { return callback(error); });\n        delete this.waiting;\n    };\n    return Mutex;\n}());\nexports.Mutex = Mutex;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXV0ZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvbXV0ZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTtJQUtJLGVBQW1CLFNBQXdCO1FBQ3ZDLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO0lBQy9CLENBQUM7SUFFTSxxQkFBSyxHQUFaLFVBQWEsUUFBZ0M7UUFDekMsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzNCLFFBQVEsRUFBRSxDQUFDO1NBQ2Q7YUFBTTtZQUNILElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUM7WUFDbEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDL0I7SUFDTCxDQUFDO0lBRUQsdURBQXVEO0lBQ2hELHFCQUFLLEdBQVosVUFBYSxLQUFhO1FBQ3RCLElBQUksSUFBSSxDQUFDLE9BQU87WUFDWixJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFDLFFBQVEsSUFBSyxPQUFBLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBZixDQUFlLENBQUMsQ0FBQztRQUN4RCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDeEIsQ0FBQztJQUNMLFlBQUM7QUFBRCxDQUFDLEFBeEJELElBd0JDO0FBeEJZLHNCQUFLIn0=","'use strict';\n\nvar isMergeableObject = function isMergeableObject(value) {\n\treturn isNonNullObject(value)\n\t\t&& !isSpecial(value)\n};\n\nfunction isNonNullObject(value) {\n\treturn !!value && typeof value === 'object'\n}\n\nfunction isSpecial(value) {\n\tvar stringValue = Object.prototype.toString.call(value);\n\n\treturn stringValue === '[object RegExp]'\n\t\t|| stringValue === '[object Date]'\n\t\t|| isReactElement(value)\n}\n\n// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25\nvar canUseSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;\n\nfunction isReactElement(value) {\n\treturn value.$$typeof === REACT_ELEMENT_TYPE\n}\n\nfunction emptyTarget(val) {\n\treturn Array.isArray(val) ? [] : {}\n}\n\nfunction cloneUnlessOtherwiseSpecified(value, options) {\n\treturn (options.clone !== false && options.isMergeableObject(value))\n\t\t? deepmerge(emptyTarget(value), value, options)\n\t\t: value\n}\n\nfunction defaultArrayMerge(target, source, options) {\n\treturn target.concat(source).map(function(element) {\n\t\treturn cloneUnlessOtherwiseSpecified(element, options)\n\t})\n}\n\nfunction getMergeFunction(key, options) {\n\tif (!options.customMerge) {\n\t\treturn deepmerge\n\t}\n\tvar customMerge = options.customMerge(key);\n\treturn typeof customMerge === 'function' ? customMerge : deepmerge\n}\n\nfunction getEnumerableOwnPropertySymbols(target) {\n\treturn Object.getOwnPropertySymbols\n\t\t? Object.getOwnPropertySymbols(target).filter(function(symbol) {\n\t\t\treturn target.propertyIsEnumerable(symbol)\n\t\t})\n\t\t: []\n}\n\nfunction getKeys(target) {\n\treturn Object.keys(target).concat(getEnumerableOwnPropertySymbols(target))\n}\n\nfunction mergeObject(target, source, options) {\n\tvar destination = {};\n\tif (options.isMergeableObject(target)) {\n\t\tgetKeys(target).forEach(function(key) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(target[key], options);\n\t\t});\n\t}\n\tgetKeys(source).forEach(function(key) {\n\t\tif (!options.isMergeableObject(source[key]) || !target[key]) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(source[key], options);\n\t\t} else {\n\t\t\tdestination[key] = getMergeFunction(key, options)(target[key], source[key], options);\n\t\t}\n\t});\n\treturn destination\n}\n\nfunction deepmerge(target, source, options) {\n\toptions = options || {};\n\toptions.arrayMerge = options.arrayMerge || defaultArrayMerge;\n\toptions.isMergeableObject = options.isMergeableObject || isMergeableObject;\n\n\tvar sourceIsArray = Array.isArray(source);\n\tvar targetIsArray = Array.isArray(target);\n\tvar sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;\n\n\tif (!sourceAndTargetTypesMatch) {\n\t\treturn cloneUnlessOtherwiseSpecified(source, options)\n\t} else if (sourceIsArray) {\n\t\treturn options.arrayMerge(target, source, options)\n\t} else {\n\t\treturn mergeObject(target, source, options)\n\t}\n}\n\ndeepmerge.all = function deepmergeAll(array, options) {\n\tif (!Array.isArray(array)) {\n\t\tthrow new Error('first argument should be an array')\n\t}\n\n\treturn array.reduce(function(prev, next) {\n\t\treturn deepmerge(prev, next, options)\n\t}, {})\n};\n\nvar deepmerge_1 = deepmerge;\n\nmodule.exports = deepmerge_1;\n","/*!\n * get-value <https://github.com/jonschlinkert/get-value>\n *\n * Copyright (c) 2014-2015, Jon Schlinkert.\n * Licensed under the MIT License.\n */\n\nmodule.exports = function(obj, prop, a, b, c) {\n  if (!isObject(obj) || !prop) {\n    return obj;\n  }\n\n  prop = toString(prop);\n\n  // allowing for multiple properties to be passed as\n  // a string or array, but much faster (3-4x) than doing\n  // `[].slice.call(arguments)`\n  if (a) prop += '.' + toString(a);\n  if (b) prop += '.' + toString(b);\n  if (c) prop += '.' + toString(c);\n\n  if (prop in obj) {\n    return obj[prop];\n  }\n\n  var segs = prop.split('.');\n  var len = segs.length;\n  var i = -1;\n\n  while (obj && (++i < len)) {\n    var key = segs[i];\n    while (key[key.length - 1] === '\\\\') {\n      key = key.slice(0, -1) + '.' + segs[++i];\n    }\n    obj = obj[key];\n  }\n  return obj;\n};\n\nfunction isObject(val) {\n  return val !== null && (typeof val === 'object' || typeof val === 'function');\n}\n\nfunction toString(val) {\n  if (!val) return '';\n  if (Array.isArray(val)) {\n    return val.join('.');\n  }\n  return val;\n}\n","/*!\n * has-value <https://github.com/jonschlinkert/has-value>\n *\n * Copyright (c) 2014-2016, Jon Schlinkert.\n * Licensed under the MIT License.\n */\n\n'use strict';\n\nvar isObject = require('isobject');\nvar hasValues = require('has-values');\nvar get = require('get-value');\n\nmodule.exports = function(obj, prop, noZero) {\n  if (isObject(obj)) {\n    return hasValues(get(obj, prop), noZero);\n  }\n  return hasValues(obj, prop);\n};\n","/*!\n * isobject <https://github.com/jonschlinkert/isobject>\n *\n * Copyright (c) 2014-2015, Jon Schlinkert.\n * Licensed under the MIT License.\n */\n\n'use strict';\n\nvar isArray = require('isarray');\n\nmodule.exports = function isObject(val) {\n  return val != null && typeof val === 'object' && isArray(val) === false;\n};\n","/*!\n * has-values <https://github.com/jonschlinkert/has-values>\n *\n * Copyright (c) 2014-2015, Jon Schlinkert.\n * Licensed under the MIT License.\n */\n\n'use strict';\n\nmodule.exports = function hasValue(o, noZero) {\n  if (o === null || o === undefined) {\n    return false;\n  }\n\n  if (typeof o === 'boolean') {\n    return true;\n  }\n\n  if (typeof o === 'number') {\n    if (o === 0 && noZero === true) {\n      return false;\n    }\n    return true;\n  }\n\n  if (o.length !== undefined) {\n    return o.length !== 0;\n  }\n\n  for (var key in o) {\n    if (o.hasOwnProperty(key)) {\n      return true;\n    }\n  }\n  return false;\n};\n","/*!\n * is-plain-object <https://github.com/jonschlinkert/is-plain-object>\n *\n * Copyright (c) 2014-2017, Jon Schlinkert.\n * Released under the MIT License.\n */\n\n'use strict';\n\nvar isObject = require('isobject');\n\nfunction isObjectObject(o) {\n  return isObject(o) === true\n    && Object.prototype.toString.call(o) === '[object Object]';\n}\n\nmodule.exports = function isPlainObject(o) {\n  var ctor,prot;\n\n  if (isObjectObject(o) === false) return false;\n\n  // If has modified constructor\n  ctor = o.constructor;\n  if (typeof ctor !== 'function') return false;\n\n  // If has modified prototype\n  prot = ctor.prototype;\n  if (isObjectObject(prot) === false) return false;\n\n  // If constructor does not have an Object-specific method\n  if (prot.hasOwnProperty('isPrototypeOf') === false) {\n    return false;\n  }\n\n  // Most likely a plain Object\n  return true;\n};\n","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n","/*!\n * isobject <https://github.com/jonschlinkert/isobject>\n *\n * Copyright (c) 2014-2017, Jon Schlinkert.\n * Released under the MIT License.\n */\n\n'use strict';\n\nmodule.exports = function isObject(val) {\n  return val != null && typeof val === 'object' && Array.isArray(val) === false;\n};\n","'use strict';\n\nvar isObject = require('is-plain-object');\nvar unset = require('unset-value');\n\nmodule.exports = function omitDeep(value, keys) {\n  if (typeof value === 'undefined') {\n    return {};\n  }\n\n  if (Array.isArray(value)) {\n    for (var i = 0; i < value.length; i++) {\n      value[i] = omitDeep(value[i], keys);\n    }\n    return value;\n  }\n\n  if (!isObject(value)) {\n    return value;\n  }\n\n  if (typeof keys === 'string') {\n    keys = [keys];\n  }\n\n  if (!Array.isArray(keys)) {\n    return value;\n  }\n\n  for (var j = 0; j < keys.length; j++) {\n    unset(value, keys[j]);\n  }\n\n  for (var key in value) {\n    if (value.hasOwnProperty(key)) {\n      value[key] = omitDeep(value[key], keys);\n    }\n  }\n\n  return value;\n};\n","/*!\n * unset-value <https://github.com/jonschlinkert/unset-value>\n *\n * Copyright (c) 2015, 2017, Jon Schlinkert.\n * Released under the MIT License.\n */\n\n'use strict';\n\nvar isObject = require('isobject');\nvar has = require('has-value');\n\nmodule.exports = function unset(obj, prop) {\n  if (!isObject(obj)) {\n    throw new TypeError('expected an object.');\n  }\n  if (obj.hasOwnProperty(prop)) {\n    delete obj[prop];\n    return true;\n  }\n\n  if (has(obj, prop)) {\n    var segs = prop.split('.');\n    var last = segs.pop();\n    while (segs.length && segs[segs.length - 1].slice(-1) === '\\\\') {\n      last = segs.pop().slice(0, -1) + '.' + last;\n    }\n    while (segs.length) obj = obj[prop = segs.shift()];\n    return (delete obj[last]);\n  }\n  return true;\n};\n","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"useoscEventEmitter\"] = factory();\n\telse\n\t\troot[\"useoscEventEmitter\"] = factory();\n})(global, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","//简单的事件库\r\n\r\nconst getEventNames = name => (name instanceof Array) //返回事件数组\r\n    ? name\r\n    : String(name).replace(/\\s+/g, '').split(',');\r\n\r\nexport class EventEmitter {\r\n    constructor(name = 'undefined') {\r\n        //事件对象名称\r\n        this.name = name;\r\n        //事件数组\r\n        this.events = {};\r\n    }\r\n\r\n    //删除事件\r\n    destroy() {\r\n        this.events = {};\r\n    }\r\n\r\n    //监听事件(options.once=>触发一次)\r\n    on(name, callback, options = {}) {\r\n        options = options || {};\r\n\r\n        if (typeof callback !== 'function') {\r\n            throw new TypeError('Invalid callback');\r\n        }\r\n\r\n        getEventNames(name).forEach(n => {\r\n            if (!this.events[n]) {\r\n                this.events[n] = [];\r\n            }\r\n\r\n            this.events[n].push({ callback, options });\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    //添加一个只触发一次的事件\r\n    once(name, callback) {\r\n        return this.on(name, callback, { once: true });\r\n    }\r\n\r\n    //删除一个事件监听\r\n    off(name, callback = null, force = false) {\r\n        getEventNames(name)\r\n            .filter(n => !!this.events[n])\r\n            .forEach(n => {\r\n                if (callback) {\r\n                    let i = this.events[n].length;\r\n                    while (i--) {\r\n                        const ev = this.events[n][i];\r\n                        const removable = !ev.options.persist || force;\r\n                        if (removable && ev.callback === callback) {\r\n                            this.events[n].split(i, 1);\r\n                        }\r\n                    }\r\n                } else {\r\n                    this.events[n] = force\r\n                        ? []\r\n                        : this.events[n].filter(({ options }) => options.persist === true);\r\n                }\r\n            });\r\n        return this;\r\n    }\r\n\r\n    //触发事件\r\n    emit(name, ...args) {\r\n        getEventNames(name).forEach(n => {\r\n            if (this.events[n]) {\r\n                let i = this.events[n].length;\r\n                while (i--) {\r\n                    const { options, callback } = this.events[n][i];\r\n\r\n                    try {\r\n                        callback(...args);\r\n                    } catch (e) {\r\n                        console.warn(e);\r\n                    }\r\n                    if (options && options.once) {\r\n                        this.events[n].split(i, 1);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        return this;\r\n    }\r\n\r\n}","import { resolveTreeByKey, providerHandler } from './utils.js';\r\nimport { EventEmitter } from 'useosc-emitter';\r\nimport merge from 'deepmerge';\r\nimport omitDeep from 'omit-deep';\r\nimport { triggerAsyncId } from 'async_hooks';\r\n\r\nexport class CoreBase extends EventEmitter {\r\n    constructor(defaultConfiguration, configuration, options) {\r\n        super('Core');\r\n\r\n        // https://github.com/KyleAMathews/deepmerge#webpack-bug\r\n        const merger = merge.default ? merge.default : merge;\r\n        const omitted = omitDeep(defaultConfiguration, options.omit || []);\r\n\r\n        this.logger = console;\r\n        this.configuration = merger(omitted, configuration);\r\n        this.options = options;\r\n        this.booted = false;\r\n        this.started = false;\r\n        this.destroyed = false;\r\n        this.providers = providerHandler(this);\r\n    }\r\n\r\n    //销毁core实例\r\n    destroy() {\r\n        if (this.destroyed) {\r\n            return false;\r\n        }\r\n\r\n        this.booted = false;\r\n        this.destroyed = true;\r\n        this.started = false;\r\n        this.providers.destroy();\r\n\r\n        super.destroy(); //清除事件监听\r\n        return true;\r\n    }\r\n\r\n    //启动useosc\r\n    boot() {\r\n        if (this.booted) {\r\n            return Promise.resolve(true);\r\n        }\r\n\r\n        this.started = false;\r\n        this.destroyed = false;\r\n        this.booted = true;\r\n\r\n        return this.providers.init(true)\r\n            .then(() => true);\r\n    }\r\n\r\n    //启动所有的core服务\r\n    start() {\r\n        if (this.started) {\r\n            return Promise.resolve(true);\r\n        }\r\n\r\n        this.started = true;\r\n\r\n        return this.providers.init(false)\r\n            .then(() => true);\r\n    }\r\n\r\n    //\r\n    config(key, defaultValue) {\r\n        return key\r\n            ? resolveTreeByKey(this.configuration, key, defaultValue)\r\n            : Object.assign({}, this.configuration);\r\n    }\r\n\r\n    //注册一个服务提供者\r\n    register(ref, options = {}) {\r\n        this.providers.register(ref, options);\r\n    }\r\n\r\n    //为服务注册新的实例工厂\r\n    instance(name, callback) {\r\n        this.providers.bind(name, false, callback);\r\n    }\r\n\r\n    //为服务注册新的单例实例工厂\r\n    singleton(name, callback) {\r\n        this.providers.bind(name, true, callback);\r\n    }\r\n\r\n    /**\r\n     * @param 服务名称\r\n     * @param args 构造参数\r\n     * @return 服务实例\r\n     */\r\n    make(name, ...args) {\r\n        return this.providers.make(name, ...args);\r\n    }\r\n\r\n    /**\r\n     * 检测服务是否存在\r\n     * @param name 服务名称\r\n     * @return {Boolean}\r\n     */\r\n    has(name) {\r\n        return this.providers.has(name);\r\n    }\r\n}","//服务提供者接口\r\n\r\nexport class ServiceProvider {\r\n    /**\r\n     * @param {Core} core Core类\r\n     */\r\n    constructor(core, options = {}) {\r\n        this.core = core;\r\n        this.options = options;\r\n    }\r\n\r\n    /**\r\n     * 服务名称（数组）\r\n     * @return {string[]}\r\n     */\r\n    provides() {\r\n        return [];\r\n    }\r\n\r\n    /**\r\n     * 服务依赖的其他服务\r\n     */\r\n    depends() {\r\n        return [];\r\n    }\r\n\r\n    //初始化服务\r\n    async init() {\r\n    }\r\n\r\n    //启动服务\r\n    start() {\r\n    }\r\n\r\n    //销毁服务提供者\r\n    destroy() {\r\n    }\r\n\r\n}","import { Graph, Node } from 'async-dependency-graph';\r\n\r\nexport const resolveTreeByKey = (tree, key, defaultValue) => {\r\n    let result;\r\n\r\n    try {\r\n        result = key\r\n            .split(/\\./g)\r\n            .reduce((result, key) => result[key], Object.assign({}, tree));\r\n    } catch (e) { /* noop */ }\r\n\r\n    return typeof result === 'undefined' ? defaultValue : result;\r\n};\r\n\r\nconst each = (list, method) => Promise.all(list.map(p => {\r\n    try {\r\n        return p.provider[method]();\r\n    } catch (e) {\r\n        return Promise.reject(e);\r\n    }\r\n}))\r\n    .catch(err => console.warn(err));\r\n\r\nexport const providerHandler = (core) => {\r\n    let instances = {};\r\n    let providers = [];\r\n    let registry = [];\r\n\r\n    //list => providers [{provider: new ref(core, options.args),options}]\r\n    const createGraph = (list, method) => {\r\n        const graph = new Graph();\r\n        const provides = list.map(p => typeof p.provider.provides === 'function' ? p.provider.provides() : []);\r\n        const dependsOnIndex = wants => provides.findIndex(arr => arr.some(a => wants.indexOf(a) !== -1));\r\n\r\n        list.forEach((p, i) => {\r\n            graph.addNode(new Node(String(i), () => {\r\n                try {\r\n                    return Promise.resolve(p.provider[method]());\r\n                } catch (e) {\r\n                    return Promise.reject(e);\r\n                }\r\n            }));\r\n        });\r\n\r\n        list.forEach((p, i) => {\r\n            const dependsOptions = p.options.depends instanceof Array\r\n                ? p.options.depends\r\n                : [];\r\n\r\n            const dependsInstance = typeof p.provider.depends === 'function'\r\n                ? p.provider.depends()\r\n                : [];\r\n\r\n            const depends = [...dependsOptions, ...dependsInstance];\r\n            if (depends.length > 0) {\r\n                const dindex = dependsOnIndex(depends);\r\n                if (dindex !== -1) {\r\n                    graph.addDependency(String(i), String(dindex));\r\n                }\r\n            }\r\n        });\r\n        return graph.traverse()\r\n            .catch(e => console.warn(e));\r\n    };\r\n\r\n    const handle = list => createGraph(list, 'init')\r\n        .then(() => createGraph(list, 'start'));\r\n\r\n\r\n    const has = name => registry.findIndex(p => p.name === name) !== -1;\r\n    const destroy = () => {\r\n        each(providers, 'destroy');\r\n\r\n        instances = {};\r\n        registry = [];\r\n    };\r\n\r\n    const init = (before) =>\r\n        handle(before\r\n            ? providers.filter(p => p.options.before)\r\n            : providers.filter(p => !p.options.before));\r\n\r\n    const register = (ref, options) => {\r\n        try {\r\n            providers.push({\r\n                provider: new ref(core, options.args),\r\n                options\r\n            });\r\n        } catch (e) {\r\n            console.error('服务注册失败', e);\r\n        }\r\n    };\r\n\r\n    const bind = (name, singleton, callback) => {\r\n        core.logger.info('服务绑定', name);\r\n\r\n        registry.push({\r\n            singleton,\r\n            name,\r\n            make(...args) {\r\n                return callback(...args);\r\n            }\r\n        })\r\n    };\r\n\r\n    const make = (name, ...args) => {\r\n        const found = registry.find(p => p.name === name);\r\n        if (!found) {\r\n            throw new Error(`服务'${name}'没有找到`);\r\n        }\r\n\r\n        if (!found.singleton) {\r\n            return found.make(...args);\r\n        }\r\n\r\n        if (!instances[name]) {\r\n            if (found) {\r\n                instances[name] = found.make(...args);\r\n            }\r\n        }\r\n\r\n        return instances[name];\r\n    };\r\n\r\n    return { register, init, bind, has, make, destroy };\r\n};","module.exports = require(\"async_hooks\");"],"sourceRoot":""}